@page "/customtasks/details"
@rendermode InteractiveServer
@using BlazorApp01.Domain.Models
@using BlazorApp01.Features.CQRS.MediatorFacade
@using BlazorApp01.Features.CQRS.Requests.CustomTasks.Queries
@inject ISenderFacade Sender

<PageTitle>Details</PageTitle>

<h1>Details</h1>

<div>
    <h4>CustomTask</h4>
    <hr />
    @if (isLoading)
    {
        <p><em>Loading...</em></p>
    }
    else if (customTask == null)
    {
        <p class="alert alert-danger">CustomTask not found.</p>
    }
    else
    {
        <dl class="row">
            <dt class="col-sm-2">Description</dt>
            <dd class="col-sm-10">@customTask.Description</dd>

            <dt class="col-sm-2">Status</dt>
            <dd class="col-sm-10">@customTask.Status</dd>

            <dt class="col-sm-2">CreatedAt</dt>
            <dd class="col-sm-10">@customTask.CreatedAt.ToString("g")</dd>

            <dt class="col-sm-2">DueDate</dt>
            <dd class="col-sm-10">@customTask.DueDate.ToString("d")</dd>

            <dt class="col-sm-2">CompletionDate</dt>
            <dd class="col-sm-10">@(customTask.CompletionDate?.ToString("g") ?? "Not completed")</dd>

            <dt class="col-sm-2">IsActive</dt>
            <dd class="col-sm-10">@(customTask.IsActive ? "Yes" : "No")</dd>

            <dt class="col-sm-2">RowVersion</dt>
            <dd class="col-sm-10">@Convert.ToBase64String(customTask.RowVersion)</dd>
        </dl>
    }
</div>
<div>
    @if (customTask != null)
    {
        <a href="@($"/customtasks/edit?customtaskid={customTask.CustomTaskId}")">Edit</a>
        <span> | </span>
    }
    <a href="/customtasks">Back to List</a>
</div>

@code {
    [SupplyParameterFromQuery]
    public int CustomTaskId { get; set; }

    private CustomTask? customTask;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var query = new GetCustomTaskByIdQuery(CustomTaskId);
        var result = await Sender.SendAsync(query);

        if (result.IsSuccess)
        {
            customTask = result.Value;
        }

        isLoading = false;
    }
}
