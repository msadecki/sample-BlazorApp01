@page "/applicationusers/details"
@rendermode InteractiveServer
@using BlazorApp01.Domain.Models
@using BlazorApp01.Features.CQRS.MediatorFacade
@using BlazorApp01.Features.CQRS.Requests.ApplicationUsers.Queries
@inject ISenderFacade Sender

<PageTitle>User Details</PageTitle>

<h1>User Details</h1>

<div>
    <h4>ApplicationUser</h4>
    <hr />
    @if (isLoading)
    {
        <p><em>Loading...</em></p>
    }
    else if (applicationUser == null)
    {
        <p class="alert alert-danger">User not found.</p>
    }
    else
    {
        <dl class="row">
            <dt class="col-sm-3">User ID</dt>
            <dd class="col-sm-9">@applicationUser.Id</dd>

            <dt class="col-sm-3">Username</dt>
            <dd class="col-sm-9">@applicationUser.UserName</dd>

            <dt class="col-sm-3">Normalized Username</dt>
            <dd class="col-sm-9">@applicationUser.NormalizedUserName</dd>

            <dt class="col-sm-3">Email</dt>
            <dd class="col-sm-9">@applicationUser.Email</dd>

            <dt class="col-sm-3">Normalized Email</dt>
            <dd class="col-sm-9">@applicationUser.NormalizedEmail</dd>

            <dt class="col-sm-3">Email Confirmed</dt>
            <dd class="col-sm-9">
                @if (applicationUser.EmailConfirmed)
                {
                    <span class="badge bg-success">Yes</span>
                }
                else
                {
                    <span class="badge bg-warning">No</span>
                }
            </dd>

            <dt class="col-sm-3">Phone Number</dt>
            <dd class="col-sm-9">@(applicationUser.PhoneNumber ?? "N/A")</dd>

            <dt class="col-sm-3">Phone Number Confirmed</dt>
            <dd class="col-sm-9">
                @if (applicationUser.PhoneNumberConfirmed)
                {
                    <span class="badge bg-success">Yes</span>
                }
                else
                {
                    <span class="badge bg-secondary">No</span>
                }
            </dd>

            <dt class="col-sm-3">Two Factor Enabled</dt>
            <dd class="col-sm-9">
                @if (applicationUser.TwoFactorEnabled)
                {
                    <span class="badge bg-success">Enabled</span>
                }
                else
                {
                    <span class="badge bg-secondary">Disabled</span>
                }
            </dd>

            <dt class="col-sm-3">Lockout Enabled</dt>
            <dd class="col-sm-9">
                @if (applicationUser.LockoutEnabled)
                {
                    <span class="badge bg-warning">Enabled</span>
                }
                else
                {
                    <span class="badge bg-success">Disabled</span>
                }
            </dd>

            <dt class="col-sm-3">Lockout End</dt>
            <dd class="col-sm-9">
                @if (applicationUser.LockoutEnd.HasValue)
                {
                    <span class="badge bg-danger">@applicationUser.LockoutEnd.Value.LocalDateTime</span>
                }
                else
                {
                    <span class="text-muted">Not locked out</span>
                }
            </dd>

            <dt class="col-sm-3">Access Failed Count</dt>
            <dd class="col-sm-9">
                <span class="badge bg-@(applicationUser.AccessFailedCount > 0 ? "warning" : "success")">
                    @applicationUser.AccessFailedCount
                </span>
            </dd>

            <dt class="col-sm-3">Security Stamp</dt>
            <dd class="col-sm-9"><small class="text-muted">@applicationUser.SecurityStamp</small></dd>

            <dt class="col-sm-3">Concurrency Stamp</dt>
            <dd class="col-sm-9"><small class="text-muted">@applicationUser.ConcurrencyStamp</small></dd>
        </dl>
    }
</div>
<div>
    <a href="/applicationusers">Back to List</a>
</div>

@code {
    [SupplyParameterFromQuery]
    public string UserId { get; set; } = string.Empty;

    private ApplicationUser? applicationUser;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var query = new GetApplicationUserByIdQuery(UserId);
        var result = await Sender.SendAsync(query);

        if (result.IsSuccess)
        {
            applicationUser = result.Value;
        }

        isLoading = false;
    }
}